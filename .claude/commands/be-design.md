# Service Logic Design Prompt

> 비즈니스 로직을 설계할 때 사용하는 command입니다.
> API 인터페이스 설계 전에 먼저 실행하여 로직을 명확히 합니다.

---

## Input 필수 항목

### 1. 기능명
$ARGUMENTS

### 2. 유저 시나리오
(누가, 무엇을, 왜 하는지)

### 3. 관련 도메인
(기존 엔티티가 있으면 명시)

---

## Output 요구사항

### 1. 비즈니스 규칙 정의
- 핵심 규칙 목록
- 제약 조건 (예: 하루 1회, 최대 10개 등)
- 예외 상황 처리

### 2. 상태 전이 다이어그램 (해당 시)
```
[상태A] ---(이벤트)---> [상태B]
```
- 각 상태의 의미
- 전이 조건
- 불가능한 전이

### 3. 시퀀스 흐름
```
1. Client → Controller: 요청
2. Controller → Service: 비즈니스 로직 호출
3. Service → Repository: 데이터 조회/저장
4. Service: 규칙 검증
5. Service → External: 외부 연동 (있으면)
6. Controller → Client: 응답
```

### 4. 트랜잭션 경계
- 어디서 시작하고 끝나는지
- 롤백 조건
- 분산 트랜잭션 필요 여부

### 5. 도메인 모델 초안
- 엔티티 관계
- 주요 필드
- 값 객체 (VO) 후보

### 6. 엣지 케이스
- 동시성 이슈
- TTL/만료 처리
- 멱등성 요구사항

---

## 사용 예시

```
/be-design 스탬프 발급

유저 시나리오:
- 고객이 매장에서 스탬프 발급을 요청한다
- 터미널(점주)이 요청을 확인하고 승인한다
- 고객 화면에서 폴링으로 승인 결과를 확인한다
- 승인되면 고객 지갑에 스탬프가 적립된다

관련 도메인: Wallet, StampCard, Store
```

**출력 예시**:
```
## 비즈니스 규칙
- 활성 상태의 StampCard에만 발급 가능
- 고객당 동시에 1개의 발급 요청만 가능
- 요청은 5분 후 자동 만료

## 상태 전이
[PENDING] ---(approve)---> [APPROVED] ---(complete)---> [COMPLETED]
[PENDING] ---(reject)---> [REJECTED]
[PENDING] ---(timeout)---> [EXPIRED]

## 트랜잭션 경계
- 승인 시: IssuanceSession 상태 변경 + Wallet 스탬프 증가 (단일 트랜잭션)
```

---

## 복잡한 기능 예시

다음과 같은 경우 반드시 `/be-design`부터 시작:
- 상태 전이가 있는 기능 (발급, 사용, 마이그레이션)
- 여러 도메인이 연관된 기능
- 폴링/TTL이 필요한 기능
- 동시성 제어가 필요한 기능

---

## 다음 단계

설계 완료 후:
1. `/be-api` → API 인터페이스 정의
2. `/be-review` → 설계 리뷰
